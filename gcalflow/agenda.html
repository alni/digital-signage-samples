<html>
<head>
    <meta charset="UTF-8">
    <link href="jquery-gcal-flow-3.0.1/jquery.gcal_flow.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load("jquery", "1.7.1");
    </script>
    <script>
        _gCalFlow_debug = true;
    </script>
    <script type="text/javascript" src="lib/moment-with-locales.min.js" charset="UTF-8"></script>
    <script type="text/javascript" src="jquery-gcal-flow-3.0.1/jquery.gcal_flow.js"></script>
    <script type="text/javascript">
        /**
         * <http://stackoverflow.com/a/5158301>
         */
        function getParameterByName(name) {
            var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
            return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
        }

        var $ = jQuery;
        $(function () {
            var CAL_ID = getParameterByName("CAL_ID");
            var DATE_FORMAT = getParameterByName("DATE_FORMAT") || "ddd, ll";
            var LANG = getParameterByName("LANG") || "nb";
            moment.lang(LANG);
            $('#gcf-custom-template').gCalFlow({
                //auto_scroll: false,
                link_title: false,
                link_item_title: false,
                calid: CAL_ID || '2dpnd6bnab0bsih2f7fkn45l8o@group.calendar.google.com',
                maxitem: 50,
                date_formatter: function (d, allday_p) {
                    if (allday_p) {
                        // If the event is all day, then return a date formatted
                        // string
                        return moment(d).format(DATE_FORMAT);
                    } else if (moment(d).diff(moment(), 'days') >= 6) {
                        // If the event is NOT all day, but the date is greater
                        // than 5 days in the future, then return a date 
                        // formatted string
                        return moment(d).format(DATE_FORMAT);
                    } else {
                        // Otherwise return a calendar formatted date time
                        return moment(d).calendar();
                    }
                },
                daterange_formatter: function (start_d, end_d, allday_p) {
                    var start, end;
                    if (allday_p) {
                        start = moment(start_d); //.format("ddd, ll");
                        if (moment(end_d).diff(start, 'days') > 1) {
                            // If the end_d is more than a day after start, 
                            // then initialize end from end_d and subtract 1 
                            // day from it (prevents overflow)
                            end = moment(end_d).subtract(1, 'days'); //.format("ddd, ll");
                        }
                        // Check if event spans from the start of week to the 
                        // end of week (locale-aware)
                        if (start.weekday() == 0 && (end && end.weekday() == 6)) {
                            // If the start is at the first weekday and the end
                            // is initialized and at the last weekday then 
                            // return a string with the current (locale aware)
                            // week number
                            return "Uke " + start.week();
                        } else {
                            // Otherwise format the start and the end
                            start = start.format(DATE_FORMAT);
                            // Only format the end if it is actually initialized
                            end = end && end.format(DATE_FORMAT);
                        }
                        // Return a string in the format "<start> - <end>" if 
                        // both start and end is set to a value.
                        // If end is not set to a value only return "<start>"
                        return start + (end ? " - " + end : "");
                        //+ " - " + moment(end_d).subtract(1, 'days').format("ddd, ll");
                    } else if (moment(start_d).diff(moment(), 'days') >= 6) {
                        // If the event is not all day and the start_d is more
                        // than 5 days in the future, then return a formatted 
                        // date string
                        return moment(start_d).format(DATE_FORMAT);
                    } else {
                        // Otherwise return a calendar formatted start_d + a 
                        // locale aware time formatted end_d in the form of 
                        // "<start_d> - <end_d>"
                        return moment(start_d).calendar()
                            + " - " + moment(end_d).format("LT");
                    }
                }
            });
        });
    </script>
    <style type="text/css">
        h2 {
            clear: both;
            margin-top: 2em;
        }

        #gcf-design .gcf-header-block {
            background: green;
            filter: none;
        }

        #gcf-design {
            height: 300px;
            width: 500px;
            background: #F0FFEE;
            filter: none;
        }
    </style>

    <link rel="stylesheet" type="text/css" href="agenda.css">
</head>
<body>
    <div id="gcf-custom-template">
        <div class="gcf-header-block">
            <div class="gcf-title-block">
                <span class="gcf-title">Your calendar name</span>
            </div>
        </div>
        <ul class="gcf-item-container-block">
            <li class="gcf-item-block">
                <div class="gcf-item-header-block">
                    <span class="gcf-item-daterange"></span><br />
                    <span class="gcf-item-title"></span><br />
                    <span class="gcf-item-location"></span>
                    <p class="gcf-item-description"></p>
                </div>
                <hr />
            </li>
        </ul>
        <div class="gcf-last-update-block">
            LastUpdate: <span class="gcf-last-update">2012-02-30 20:58</span>
        </div>
    </div>
</body>
</html>
