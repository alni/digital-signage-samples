<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!--
        # Flickr image slide show #

        ## Supported URI Query Parameters ##

        Supports the following URI Query Parameters:
        * TAGS : (required) the tags to use to search for images (separated by
          commas ("%2C" when URI encoded)
            * Default : "wild"
        * INTERVAL : (optional) the slide interval in seconds
            * Default : 3
        * NUM_ITEMS : (optional) the number of images to include with the
          slide show
            * Default : 10
        * TITLE ; (optional) the title to use for the slide show
        * API_KEY : (optional) a Flickr API Key. Specify this if more fine-
          grained filtering is required (like only "Commercial use allowed")
            * Uses the "flickr.photos.search" API instead of the Feed Service

        Examples:
            flickr.html?TAGS=national%2Cday%2Cnorway&INTERVAL=10&MAX_ITEMS=10
              * Slide show with 10 items with the tags national, day, norway
                (Norway National Day) shown with an 10 seconds interval
            flickr.html?TAGS=easter%2Choliday%2Ccelebration&MAX_ITEMS=20
              * Slide show with 20 items with the tags easter, holiday,
                celebration (Easter Holiday Celebration) shown with the default
                3 seconds interval
    -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="coin-slider/coin-slider.js"></script>

    <link rel="stylesheet" href="coin-slider/coin-slider-styles.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="styles.css" />


    <title>Coin Slider: jQuery Image Slider Plugin with Unique Effects</title>
</head>
<body class="flickr">
    <div id="header"></div>
    <div id="games"></div>
    <script>
        /**
          * <http://stackoverflow.com/a/5158301>
          */
        function getParameterByName(name) {
            var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
            return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
        }
        var baseUrl = "https://api.flickr.com/services/";
        var initCoinSlider = null;

        var createItem = function (src, title, datetaken, ownername) {
            var sDate = new Date(datetaken).toLocaleString();
            var $elem = $("<a/>");
            $("<img/>").attr({ src: src }).appendTo($elem);
            //.appendTo("#games");
            $elem.append("<span><b>" + title + " (" + sDate + ")</b><br /> by " + ownername);
            $elem.appendTo("#games");
        };

        var onResizeWindow = function () {
            var h = document.documentElement.clientHeight,
                w = document.documentElement.clientWidth;
            if (h < w) {
                $("#games").css("zoom", h / 270);
            } else {
                $("#games").css("zoom", w / 270);
            }
        };

        $(window).on("resize", onResizeWindow);

        var TAGS = getParameterByName("TAGS") || "wild";
        var NUM_ITEMS = getParameterByName("NUM_ITEMS") || 10;
        var INTERVAL = getParameterByName("INTERVAL") || 3;
        var API_KEY = getParameterByName("API_KEY");
        var TITLE = getParameterByName("TITLE");
        initCoinSlider = function () {
            $(window).trigger("resize");
            //$("#games").css("zoom", document.documentElement.clientHeight / 270);
            $('#games').coinslider({
                hoverPause: false,
                navigation: false,
                opacity: 1.0, // opacity of title and navigation
                delay: +INTERVAL * 1000,
                //delay: 3000 * 1000,
                width: 480, // width of slider panel
                height: 270, // height of slider panel
                //spw: 7, // squares per width
                //sph: 5, // squares per height
                //width: document.documentElement.clientWidth,
                //height: document.documentElement.clientHeight
            });
        }
        if (!!API_KEY) {
            $.getJSON(baseUrl + "rest/?jsoncallback=?", {
                method: "flickr.photos.search",
                api_key: API_KEY,
                tags: TAGS,
                tag_mode: "all",
                format: "json",
                orientation: "landscape",
                license: [ // Commercial use allowed
                    4, // Attribution License
                    5, // Attribution-ShareAlike License
                    6, // Attribution-NoDerivs License
                    9, // Public Domain Dedication (CC0)
                    10 // Public Domain Mark
                ].join(","),
                sort: "date-posted-desc",
                extras: "owner_name,date_taken"
            }, function (data) {
                $("#header").text(TITLE || "");
                $.each(data.photos.photo, function (i, item) {
                    console.log(item)
                    var src = [
                        "https://farm", item.farm,
                        ".staticflickr.com/", item.server,
                        "/", item.id, "_", item.secret, ".jpg"
                    ].join("");
                    createItem(src, item.title, item.datetaken, item.ownername);
                    if (i == NUM_ITEMS || i + 1 == data.photos.photo.length) {
                        initCoinSlider();
                        return false;
                    }
                })
            });
        } else {
            $.getJSON(baseUrl + "feeds/photos_public.gne?jsoncallback=?", {
                tags: TAGS || "wild",
                tagmode: "all",
                format: "json"
            }, function (data) {
                $("#header").text(TITLE  || data.title);
                $.each(data.items, function (i, item) {
                    console.log(item)
                    var src = item.media.m.replace("_m.", ".");
                    createItem(src, item.title, item.date_taken, item.author);
                    if (i == NUM_ITEMS || i + 1 == data.items.length) {
                        initCoinSlider();
                        return false;
                    }
                });
            });
        }
        //$('#games').coinslider();
    </script>

</body>

</html>